import requests
from bs4 import BeautifulSoup
import os
from urllib.parse import urljoin
import datetime

# --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø· ---
TARGET_URL = "https://uploadi.vercel.app/cur.html"
OUTPUT_FILE = "index.html"  # Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù€ GitHub Pages

# --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ù†ØµØ© (Ø³ÙŠØªÙ… Ø­Ù‚Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠÙ‡) ---
HTML_TEMPLATE = """
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academy - Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {{ --primary: #0ea5e9; --dark: #0f172a; --card: #1e293b; --text: #f1f5f9; }}
        body {{ font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--dark); color: var(--text); margin: 0; padding: 0; }}
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header {{ background: linear-gradient(to right, #1e293b, #0f172a); padding: 2rem; text-align: center; border-bottom: 3px solid var(--primary); }}
        h1 {{ margin: 0; font-size: 2.5rem; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; }}
        p.subtitle {{ color: #94a3b8; margin-top: 10px; }}
        
        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .container {{ max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }}
        .update-time {{ text-align: center; color: #64748b; font-size: 0.9rem; margin-bottom: 20px; }}
        
        .grid {{ display: grid; gap: 15px; }}
        
        /* ÙƒØ§Ø±Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        .card {{
            background: var(--card); padding: 1.5rem; border-radius: 12px;
            display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
            border: 1px solid #334155; transition: 0.3s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }}
        .card:hover {{ transform: translateY(-3px); border-color: var(--primary); }}
        
        .info {{ display: flex; align-items: center; gap: 15px; }}
        .icon-box {{ width: 40px; height: 40px; background: rgba(14, 165, 233, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary); }}
        .title {{ font-weight: bold; font-size: 1.1rem; }}
        
        .actions {{ margin-top: 10px; display: flex; gap: 10px; }}
        
        .btn {{
            background: var(--primary); color: white; text-decoration: none;
            padding: 10px 20px; border-radius: 8px; font-weight: bold;
            display: inline-flex; align-items: center; gap: 8px; transition: 0.2s;
        }}
        .btn:hover {{ background: #0284c7; }}
        .btn-play {{ background: #22c55e; }}
        .btn-play:hover {{ background: #16a34a; }}

        footer {{ text-align: center; padding: 2rem; color: #475569; margin-top: 2rem; border-top: 1px solid #1e293b; }}
    </style>
</head>
<body>

    <header>
        <h1><i class="fas fa-graduation-cap"></i> ACADEMY</h1>
        <p class="subtitle">Ù…Ù†ØµØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬</p>
    </header>

    <div class="container">
        <div class="update-time">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ù…Ø­ØªÙˆÙ‰: {date}</div>
        <div class="grid">
            {content}
        </div>
    </div>

    <footer>
        All Rights Reserved &copy; 2024 Academy Platform
    </footer>

</body>
</html>
"""

def build_site():
    print("ğŸš€ Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ©...")
    try:
        # 1. Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        headers = {'User-Agent': 'Mozilla/5.0'}
        response = requests.get(TARGET_URL, headers=headers)
        soup = BeautifulSoup(response.text, 'html.parser')
        
        cards_html = ""
        count = 0
        
        # 2. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
        for link in soup.find_all('a'):
            href = link.get('href')
            text = link.text.strip()
            
            if href:
                full_url = urljoin(TARGET_URL, href)
                # Ø´Ø±ÙˆØ· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (ÙŠÙ…ÙƒÙ† Ø²ÙŠØ§Ø¯ØªÙ‡Ø§)
                is_video = any(full_url.lower().endswith(ext) for ext in ['.mp4', '.mkv', '.avi', '.mov'])
                is_watch = "video" in full_url.lower() or "watch" in full_url.lower()
                
                if is_video or is_watch:
                    count += 1
                    name = text if text else f"Ù…Ø­Ø§Ø¶Ø±Ø© Ø±Ù‚Ù… {count}"
                    
                    # ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„ÙˆØ§Ø­Ø¯
                    cards_html += f"""
                    <div class="card">
                        <div class="info">
                            <div class="icon-box"><i class="fas fa-play"></i></div>
                            <div class="title">{name}</div>
                        </div>
                        <div class="actions">
                            <a href="{full_url}" class="btn" download target="_blank"><i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„</a>
                            <a href="{full_url}" class="btn btn-play" target="_blank"><i class="fas fa-eye"></i> Ù…Ø´Ø§Ù‡Ø¯Ø©</a>
                        </div>
                    </div>
                    """
        
        if count == 0:
             cards_html = "<h3 style='text-align:center; color:#ef4444;'>âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¹Ù…Ù„.</h3>"

        # 3. Ø¯Ù…Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø¹ Ø§Ù„ØªØµÙ…ÙŠÙ…
        now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M")
        final_html = HTML_TEMPLATE.format(content=cards_html, date=now)
        
        # 4. Ø§Ù„Ø­ÙØ¸
        with open(OUTPUT_FILE, "w", encoding="utf-8") as f:
            f.write(final_html)
            
        print(f"âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ {count} ÙÙŠØ¯ÙŠÙˆ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù {OUTPUT_FILE}")
        
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£: {e}")

if __name__ == "__main__":
    build_site()
